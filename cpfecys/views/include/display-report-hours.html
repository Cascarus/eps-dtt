<div class="row-fluid">
    <div class="well">
        <div class="row">
            {{if inc_vars['editable']:}}
                <div class="col-12 pull-right text-right">
                    <div class="btn-group">
                        <a href="#{{=inc_vars['edit_action']}}" data-toggle="modal" class="btn btn-primary">
                            <span class="fa fa-pencil"></span>
                        </a>
                        <a href="#{{=inc_vars['delete_action']}}" data-toggle="modal" class="btn btn-danger">
                            <span class="fa fa-trash"></span>
                        </a>
                    </div>
                </div>
            {{pass}}
        </div>
        <div class="row">
            <div class="col-6">
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <td>
                                <strong>Reportado</strong>
                            </td>
                            <td>
                                <strong>Cantidad</strong>
                            </td>
                            <td>
                                <strong>Horas pendientes</strong>
                            </td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            {{hours_left = inc_vars['reports'].first().assignation.hours}}
                            <td>Cantidad inicial</td>
                            <td></td>
                            <td>{{=hours_left}}</td>
                            </tr>
                            {{for _report in inc_vars['reports']:}}
                                <tr>
                                    <td>{{=_report.report_restriction['name']}}</td>
                                    <td>{{=_report.hours or 0}}</td>
                                    {{hours_left = hours_left - (_report.hours or 0)}}
                                    <td>{{=hours_left}}</td>
                                </tr>
                            {{pass}}
                            <tr>
                                <td>Horas restantes</td>
                                <td></td>
                                <td>{{=hours_left}}</td>
                            </tr>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-6">
                <h2></h2>
                <div>
                    <div style="width:100%; height:300px;" id="graphpie{{=inc_vars['id']}}"></div>
                </div>
                <div>
                    <div class="mt-2" style="width:100%; height:300px;" id="graphbars{{=inc_vars['id']}}"></div>
                </div>
                <script type="text/javascript">
                    $(function () {
                        let faltantes = {{=hours_left / 400.0}}
                        let completadas = {{=(400 - hours_left) / 400.0}}
                        new Highcharts.Chart({
                            chart: {
                                renderTo: 'graphpie{{=inc_vars["id"]}}',
                                plotBackgroundColor: null,
                                plotBorderWidth: null,
                                plotShadow: false
                            },
                            title: {
                                text: 'Faltantes vs. Completadas'
                            },
                            tooltip: {
                                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                            },
                            plotOptions: {
                                pie: {
                                    allowPointSelect: true,
                                    cursor: 'pointer',
                                    dataLabels: {
                                        enabled: true,
                                        color: '#000000',
                                        connectorColor: '#000000',
                                        format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                                    }
                                }
                            },
                            series: [{
                                type: 'pie',
                                name: 'Faltantes vs. Completadas',
                                data: [
                                    ['Faltantes', faltantes],
                                    ['Completadas', completadas]
                                ]
                            }]
                        });

                        new Highcharts.Chart({
                            chart: {
                                renderTo: 'graphbars{{=inc_vars["id"]}}',
                                type: 'column',
                                margin: [ 50, 50, 100, 80]
                            },
                            title: {
                                text: '{{=T("Accomplished Hours")}}'
                            },
                            xAxis: {
                                categories: [
                                    {{for _report in inc_vars['reports']:}}
                                        "{{=_report.report_restriction['name']}}",
                                    {{pass}}
                                ],
                                labels: {
                                    rotation: -45,
                                    align: 'right',
                                    style: {
                                        fontSize: '13px',
                                        fontFamily: 'Verdana, sans-serif'
                                    }
                                }
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: 'Horas'
                                }
                            },
                            legend: {
                                enabled: false
                            },
                            tooltip: {
                                pointFormat: 'Horas: <b>{point.y:.1f}</b>',
                            },
                            series: [{
                                name: 'Horas',
                                data: [
                                    {{for _report in inc_vars['reports']:}}
                                        {{=_report.hours}},
                                    {{pass}}
                                ],
                                dataLabels: {
                                    enabled: true,
                                    rotation: -90,
                                    color: '#FFFFFF',
                                    align: 'right',
                                    x: 4,
                                    y: 10,
                                    style: {
                                        fontSize: '13px',
                                        fontFamily: 'Verdana, sans-serif',
                                        textShadow: '0 0 3px black'
                                    }
                                }
                            }]
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</div>
