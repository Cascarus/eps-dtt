{{extend 'dashboard.html'}}
<div class="mt-4">
	<div class="row">
		<div class="col-12">
			<!--REPORT CONTENTS-->
			<!--HEADER OF REPORT-->
			{{if request.vars['level'] is not None and str(request.vars['level']) != "1":}}
				<div class="pull-left">
					<a style="white-space:nowrap; cursor:pointer; align:right;" class="btn btn-primary" onclick="levelUP();">
						<span class="icon-black icon-arrow-up"></span><b>{{=T('Level Up')}}</b>
					</a>
				</div>
			{{pass}}
			<div class="pull-right">
				<a class="btn btn-success" onclick="exportCSV();"><img src="{{=URL('static','images')}}/icono_CSV.png"></a>
			</div>
			<center><h1>Resumen de reporte</h1></center>
			<hr>
			<img class="pull-right" src="{{=URL('static','images')}}/escudo.png">
			<center><strong>Universidad de San Carlos de Guatemala</strong><br/>
			<strong>Facultad de Ingeniería</strong><br/>
			<strong>Escuela de Ingeniería en Ciencias y Sistemas</strong></center><br/>
			<table>
				<tr>
					<td><strong>Tipo</strong></td>
					<td>Información general</td>
				</tr>
				<tr>
					<td><strong>Descripción</strong></td>
					<td>Reporte sobre la información general de los cursos registrados en el sistema.</td>
				</tr>
				<tr>
					<td><strong>Periodo</strong></td>
					<td>{{=T(period.period.name)}} {{=period.yearp}}</td>
				</tr>
			</table>
			<!--HEADER OF REPORT-->
			{{if request.vars['level'] is None or str(request.vars['level']) == "1":}}
				<form class="form-inline" action="{{=URL('school_reports','general_information')}}" method='get'>
					<select name="period" class="form-control">
						{{for period_i in group_periods:}}
							{{if str(period_i.id) == str(period.id):}}
								{{var_sel = "selected='selected'"}}
							{{else:}}
								{{var_sel = ''}}
							{{pass}}
							<option value="{{=period_i.id}}" {{=var_sel}}>
								{{=T(period_i.period.name)}}-{{=period_i.yearp}}
							</option>
						{{pass}}
					</select>
					<input class="btn btn-primary" type="submit" value="{{=T('Go')}}">
				</form>
				<table class="pull-right table-striped table-bordered">
					<tr>
						<th colspan="3"><center>Filtrar cursos</center></th>
					</tr>
					<tr>
						<td>
							<a style="cursor:pointer;" onclick="visible_C(1);" title="Mostrar todos los cursos">
								<span class="badge badge-info">Todos</span>
							</a>
						</td>
						<td>
							<a style="cursor:pointer;" onclick="visible_C(2);" title="Mostrar cursos activos">
								<span class="badge badge-success">Activos</span>
							</a>
						</td>
						<td>
							<a style="cursor:pointer;" onclick="visible_C(3);" title="Mostrar cursos inactivos">
								<span class="badge badge-secondary">Inactivos</span>
							</a>
						</td>
					</tr>
				</table>
				<br/><br/><br/>
				<hr>
				<!--REPORT IN TABLE-->  
				<table class="table table-striped table-bordered">
					<tr>
						<th>Curso</th>
						<th><center>Catedráticos activos</center></th>
						<th><center>Tutores académicos asignados</center></th>
						<th><center>Estado del curso</center></th>
					</tr>
					{{for project in info_level:}}
						{{if project[2] > 0 or project[3] > 0:}}
							<tr class="course_active">
						{{else:}}
							<tr class="course_inactive">
						{{pass}}
							<td>{{=project[1]}}</td>
							<td><center>{{=project[2]}}</center></td>
							<td><center>{{=project[3]}}</center></td>
							<td>
								<center>
									{{if project[2] > 0 or project[3] > 0:}}
										<a style="cursor:pointer;" onclick="next_Level({{=project[0]}});" title="Ir al curso">
											<span class="badge badge-success">Activo</span>
										</a>
									{{else:}}
										<span class="badge badge-secondary">Inactivo</span>
									{{pass}}
								</center>
							</td>
						</tr>
					{{pass}}
				</table>
				<!--REPORT IN TABLE-->
			{{elif str(request.vars['level']) == "2":}}
				<br/><strong>Curso: </strong>{{=project.name}}<br/><br/>
				<table class="table table-striped table-bordered">
					<tr>
						<th colspan="2"><center>Información del curso</center></th>
					</tr>
					<tr>
						<!--Assigned Users-->
						<td>
							<b>Catedrático activo:</b><br/>
							{{if len(info_level[0]) <= 0:}}
								<div style="padding:0px 140px;">
									<b>No asignado</b>
								</div>
							{{else:}}
								{{for student in info_level[0]:}}
									<table class="table table-striped table-bordered">
										<tr>
											<td>
												<center><img src="{{= URL('default/download', student.assigned_user.photo)}}" alt="No photo" height="50%" width="50%"></center>
											</td>
											<td>
												<b>Nombre de usuario:</b> {{=student.assigned_user.username}}<br>
												<b>Nombre:</b> {{=student.assigned_user.first_name}} {{=student.assigned_user.last_name}}<br>
												<b>Correo electrónico:</b> {{=student.assigned_user.email}}<br>
												<b>Teléfono:</b> {{=student.assigned_user.phone}}
											</td>
										</tr>
									</table>
								{{pass}}
							{{pass}}
							<br>
							<b>Tutor asignado:</b>
							{{if len(info_level[1]) <= 0:}}
								<div style="padding:0px 140px;">
									<b>No asignado</b>
								</div>
							{{else:}}
								{{for student in info_level[1]:}}
									<table class="table table-striped table-bordered">
										<tr>
											<td>
												<center><img src="{{= URL('default/download', student.assigned_user.photo)}}" alt="No photo" height="50%" width="50%"></center>
											</td>
											<td>
												<b>Nombre de usuario:</b> {{=student.assigned_user.username}}<br>
												<b>Nombre:</b> {{=student.assigned_user.first_name}} {{=student.assigned_user.last_name}}<br>
												<b>Correo electrónico:</b> {{=student.assigned_user.email}}<br>
												<b>Teléfono:</b> {{=student.assigned_user.phone}}
											</td>
										</tr>
									</table>
								{{pass}}
							{{pass}}
						</td>
						<!--Timetable-->
						<td>
							<b>Horario clase:</b>
							{{if len(info_level[2]) <= 0:}}
								<div style="padding:0px 140px;">
									<b>No asignado</b>
								</div>
							{{else:}}
								{{for student in info_level[2]:}}
									<br/>
									<div style="padding:0px 140px;">
										<b>Ubicación:</b> {{=student.physical_location}}<br>
										<b>Día:</b> {{=db(db.day_of_week.id == student.day_of_week).select().first()['name']}}<br>
										<b>Hora de inicio:</b> {{=student.start_time}}<br>
										<b>Hora de finalización:</b> {{=student.end_time}}<br>
									</div>
								{{pass}}
							{{pass}}
							<br>
							<b>Horario laboratorio:</b>
							{{if len(info_level[3]) <= 0:}}
								<div style="padding:0px 140px;">
									<b>No asignado</b>
								</div>
							{{else:}}
								{{for student in info_level[3]:}}
									<br/>
									<div style="padding:0px 140px;">
										<b>Ubicación:</b> {{=student.physical_location}}<br>
										<b>Día:</b> {{=db(db.day_of_week.id == student.day_of_week).select().first()['name']}}<br>
										<b>Hora de inicio:</b> {{=student.start_time}}<br>
										<b>Hora de finalización:</b> {{=student.end_time}}<br>
									</div>
								{{pass}}
							{{pass}}
						</td>
					</tr>
				</table>
			{{pass}}
			<!--REPORT CONTENTS-->    
		</div>
	</div>
</div>

<script type="text/javascript">
	{{if request.vars['level'] is None or str(request.vars['level']) == "1":}}
		function visible_C(id){
			if (id == 1) {
				$(".course_active").css("display", "");
				$(".course_inactive").css("display", "");
			} else {
				if (id == 2) {
					$(".course_active").css("display", "");
					$(".course_inactive").css("display", "none");
				} else {
					$(".course_active").css("display", "none");
					$(".course_inactive").css("display", "");
				}
			}
		}

		function next_Level(id){
			window.location.href = `{{=URL('school_reports', 'general_information')}}?level=2&amp;period={{=period.id}}&amp;project=${id}`;
		}

		function exportCSV(){
			window.location.href = "{{=URL('school_reports', 'general_information_export', vars=dict(list_type='csv', level='1',period=period.id))}}";
		}
	{{else:}}
		function levelUP(){
			window.location.href = "{{=URL('school_reports', 'general_information')}}?period={{=period.id}}";
		}

		function exportCSV(){
			window.location.href = "{{=URL('school_reports', 'general_information_export', vars=dict(list_type='csv', level='2', period=str(request.vars['period']), project=str(request.vars['project'])))}}";
		}
	{{pass}}
</script>