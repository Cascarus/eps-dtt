{{extend 'dashboard.html'}}

<div class="mt-4">
    <div class="col-12">
        <div class="well span12" style="overflow:auto;">
            <a  href="{{=URL('activity_control', 'courses_list')}}" class="btn btn-primary"><i class="icon-arrow-left"></i>{{=T('Back')}}</a>
            <table style="align:0 auto;">
                <tr>
                    <td>
                        <form class="form-inline" action="{{=URL('notification', 'teacher_register_mail_notifications')}}" method='get'>
                            <select name="period" class="form-control">
                                {{for period in periods:}}
                                    {{if str(period.id) == str(request.vars['period']):}}
                                        {{var_sel="selected='selected'"}}
                                    {{else:}}
                                        {{var_sel=''}}
                                    {{pass}}
                                    <option value="{{=period.id}}" {{=var_sel}}>
                                        {{=T(period.period.name)}}-{{=period.yearp}}
                                    </option>
                                {{pass}}
                            </select>
                            <input class="btn btn-primary" type="submit" value="{{=T('Go')}}">
                        </form>
                    </td>
                </tr>
            </table>
            <table class="table table-striped table-bordered">
                {{for project in projects:}}
                    {{if (str(project.project.id) == request.vars['project']) or (request.vars['type'] == None):}}
                        <tr>
                            <td>
                                <b>{{=project.project.name}}</b>
                            </td>
                            <td>
                                <center>
                                    <a id="pr-{{=project.id}}" style="white-space:nowrap;" class="btn btn-info">Ver</a>
                                </center>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div id="div_project_{{=project.id}}" style="display: none;">
                                    <table class="table table-striped table-bordered">
                                        <tr>
                                            <td>
                                                <b>Avisos Propios</b>
                                            </td>
                                            <td>
                                                <center>
                                                    <a id="pr-{{=project.id}}-propios" class="btn btn-success">Ver</a>
                                                </center>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <div id="div_project_{{=project.id}}_propios" style="display: none; background-color:white; height:300px;  overflow:auto;">
                                                    Cargando
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="2">
                                                <b>Practicantes Finales</b>
                                            </td>
                                        </tr>
                                        {{for assignation in obtain_persons(project):}}
                                            <tr>
                                                <td>
                                                    {{=f"{assignation.assigned_user.username} - {assignation.assigned_user.first_name} {assignation.assigned_user.last_name}"}}
                                                </td>
                                                <td>
                                                    <center>
                                                        <a id="pr-{{=project.id}}-{{=assignation.id}}" class="btn btn-alert">Ver</a>
                                                    </center>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan="2">
                                                    <div id="div_project_{{=project.id}}_{{=assignation.id}}" style="display: none; background-color:white;  height:300px; overflow:auto;">
                                                        {{=T('Cargando')}}...
                                                    </div>
                                                </td>
                                            </tr>
                                        {{pass}}
                                    </table>
                                </div>
                                <br><br>
                            </td>
                        </tr>
                    {{pass}}
                {{pass}}
            </table>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="attachModal" tabindex="-1" role="dialog" aria-labelledby="attachModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="attachModalLabel">{{=T('Register Notices Detail')}}</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <div id="detalle" value="detalle" class="well">

            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        {{for project in projects:}}
            $("#pr-{{=project.id}}").click(function(){         
                $("#div_project_{{=project.id}}").toggle();
            })
            $("#pr-{{=project.id}}-propios").click(function(){         
                $("#div_project_{{=project.id}}_propios").toggle();
                $("#div_project_{{=project.id}}_propios").load("{{=URL('notification', 'teacher_register_mail', vars=dict(project=project.id, period=request.vars['period']))}}");  
            })
            {{for assignation in obtain_persons(project):}}
              $("#pr-{{=project.id}}-{{=assignation.id}}").click(function(){         
                    $("#div_project_{{=project.id}}_{{=assignation.id}}").toggle();
                    $("#div_project_{{=project.id}}_{{=assignation.id}}")
                        .load("{{=URL('notification','teacher_register_mail')}}", {userN:{{=assignation.assigned_user}}, project: {{=project.id}}, period: {{=request.vars["period"]}}});  
                })  
            {{pass}}
        {{pass}}
    })
</script>