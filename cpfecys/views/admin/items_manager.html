{{extend 'dashboard.html'}}
<div class="mt-4">
  <div class="row">
    <div class="col-12 text-center">
      <h3>ABC de entregables</h3>
    </div>
    <div class="col-12 mt-3">
      <a onclick="window.history.back()" class="btn btn-primary"
        ><i class="icon-arrow-left"></i>{{=T('Back')}}</a
      >
      <!-- Inicio - Prácticas Finales(DS) - Fernando Reyes -->
      {{if 'item_id' in action:}}
      <a
        href="{{=URL('admin', 'signature_assignment',vars={'document' : action['item_id'], 'reference' : 'item'})}}"
      >
        <button class="btn btn-primary">
          <span class="fa fa-pencil-square-o"></span>
          &nbsp;Asignación de Firmas
        </button>
      </a>
      {{pass}}
      <!-- Fin - Prácticas Finales(DS) - Fernando Reyes -->
    </div>
    <div class="col-12 mt-3">
      <form
        class="form-inline"
        action="{{=URL('admin','items_manager')}}"
        method="get"
      >
        <!--emarquez: control de periodo , -->
        <input
          id="chkTipoCurso"
          name="tipo_periodo"
          type="checkbox"
          data-toggle="toggle"
          data-on="Periodos"
          data-off="Semestres"
          data-size="mini"
        />
        <input class="btn btn-primary" type="submit" value="{{=T('Go')}}" />
      </form>
    </div>
    <div class="col-12 mt-3">
      <p>{{=grid}}</p>
    </div>
  </div>
</div>
{{block page_js}}
<script type="text/javascript">
  //variables globales, obteniendo informacion importante del controler (period_year y period)
  $(document).ready(function () {
    var year = "{{=year}}";
    var first_month = "00";
    var second_month = "05";
    var day = "01";

    $("#item_restriction_limit_days__row").append(
      '<div id="gen_content">\
			<div class="label label-info" id="start"></div>\
			<div class="label label-info" id="end"></div></div>'
    );
    $("#item_restriction_min_score__row").append(
      '<div class="label label-info">Ingrese valor entre 1 y 100</div>'
    );
    $("#item_restriction_period__row").append(
      '<div class="label label-important">Este dato es importante\
			por favor eliga siempre el peridio en el que se esta\
			creando el entregable</div>'
    );
    $("#start").html(
      '<div>\
			Primer Semestre: {{=T("Insert days to calculate")}}</div>'
    );
    $("#end").html(
      '<div>\
			Segundo Semestre: {{=T("Insert days to calculate")}}</div>'
    );

    $("#item_restriction_limit_days").on("keyup", function () {
      var first_date = new Date(year, first_month, day);
      var second_date = new Date(year, second_month, day);
      var new_first_date = calculate_date($(this).val(), first_date);
      var new_second_date = calculate_date($(this).val(), second_date);
      $("#start").html("<div>Primer Semestre: " + new_first_date + "</div>");
      $("#end").html("<div>Segundo Semestre: " + new_second_date + "</div>");
    });

    function calculate_date(days, date) {
      var new_date = new Date(date);
      new_date.setDate(new_date.getDate() + parseInt(days));
      new_date = new Date(new_date);
      return new_date;
    }

    $("form").submit(function () {
      if (
        $("#item_restriction_item_type option:selected").text() ==
        "Grade Activity"
      ) {
        if ($("#item_restriction_min_score").val() == "") {
          alert("{{=T('Please insert a minimum grade')}}");
          return false;
        }
      }
    });

    if (
      $("#item_restriction_item_type option:selected").text() ==
      "Grade Activity"
    ) {
      is_grade();
    } else if (
      $("#item_restriction_item_type option:selected").text() == "Schedule"
    ) {
      is_schedule();
    } else {
      default_case();
    }

    $("#item_restriction_item_type").change(function () {
      if (
        $("#item_restriction_item_type option:selected").text() ==
        "Grade Activity"
      ) {
        is_grade();
      } else if (
        $("#item_restriction_item_type option:selected").text() == "Schedule"
      ) {
        is_schedule();
      } else {
        default_case();
      }
    });

    function is_grade() {
      $("#item_restriction_min_score").css("visibility", "visible");
      $("#item_restriction_min_score__label").css("visibility", "visible");
      $("#item_restriction_is_unique").css("visibility", "hidden");
      $("#item_restriction_is_unique__label").css("visibility", "hidden");
    }

    function is_schedule() {
      $("#item_restriction_min_score").css("visibility", "hidden");
      $("#item_restriction_min_score__label").css("visibility", "hidden");
      $("#item_restriction_is_unique").css("visibility", "visible");
      $("#item_restriction_is_unique__label").css("visibility", "visible");
    }

    function default_case() {
      $("#item_restriction_min_score").css("visibility", "hidden");
      $("#item_restriction_min_score__label").css("visibility", "hidden");
      $("#item_restriction_is_unique").css("visibility", "hidden");
      $("#item_restriction_is_unique__label").css("visibility", "hidden");
    }

    $("#chkTipoCursoA").change(function () {
      //$("#period").effect("highlight" );
      if ($(this).prop("checked")) llenaComboPeriodosSemestresAjax("period");
      else llenaComboPeriodosVariablesAjax("period");
    });
  });
</script>
{{end page_js}}
