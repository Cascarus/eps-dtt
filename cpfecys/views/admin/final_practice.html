{{extend 'dashboard.html'}}
<div class="col-12 text-center mt-4">
  <h2>
    Administración de práctica final
    <a href="#myModal" role="button" class="btn btn-primary" data-toggle="modal">
      <span class="fa fa-question-circle"></span>
    </a>
  </h2>
  <small>{{=T(currentyear_period.period.name)}} - {{=currentyear_period.yearp}}</small>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel">
          {{=T('Final Practice Administration Help')}}
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>
          {{=T('This List represents the current assignation of final practice projects for each user. You can enroll any user or delete its enrollment here. The type of enrollment (Student or Teacher) depends on each user Membership to a group.')}}
        </p>
        <p>
          {{=T('So, for example if you want to enroll a student with carnet 200010101 to a project, first the student should be created as a user here. Then its membership should be added to a Student type. Then in this area he should be assigned to the project and automatically he can participate in the enrollment as the role he belongs (Student in this case).')}}
        </p>
        <p>
          {{=T('Bulk uploads automatically assigns the role Student if not defined before.')}}
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">
          {{=T('Close')}}
        </button>
      </div>
    </div>
  </div>
</div>

<!--emarquez: modificacion logica de pestañas-->
{{checked_var = ''}}
{{if type == 1:}}
  {{checked_var = 'checked'}}
{{pass}}
{{if 'type' in request.vars and request.vars['type'] == '1':}}
  {{checked_var = 'checked'}}
{{pass}}
Seleccione tipo de periodo <br />
<input id="chkTipoCurso" type="checkbox" {{=checked_var}} data-toggle="toggle" data-on="Semestres" data-off="Periodos" data-size="mini"/>
<!--emarquez: fin -->

<div class="tabbable">
  <!-- Only required for left/right tabs -->
  <!--emarquez id de tab-->
  <ul class="nav nav-tabs" id="listaTab">
    {{for item in periods_before:}}
      <!--emarquez: cambio de parametro para enviar el correcto-->
      <li class="nav-item">
        <a class="nav-link text-center" href="{{=URL(vars=dict(year_period=item.period_year.id,type=type))}}">
          <span class="text-center">
            {{=item.period_year.yearp}}
            <br />
            {{=T(item.period.name)}}
          </span>
        </a>
      </li>
    {{pass}}
    <li id="upload1" class="nav-item">
      <a class="nav-link text-center" href="{{=URL('assignation_upload', vars=dict(type=type,year_period=currentyear_period.id))}}">
        Asignación de tutores 
        <br/>
        por CSV
      </a>
    </li>
    <li id="upload2" class="nav-item">
      <a class="nav-link text-center" href="{{=URL('teacher_assignation_upload', vars=dict(type=type,year_period=currentyear_period.id))}}">
        Asignación de catedrático
        <br/>
        por CSV
      </a>
    </li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane active" id="data{{=currentyear_period.id}}">
      {{=grid}}
    </div>
  </div>
</div>

{{block page_js}}
<!--emarquez: javascript-->
<script type="text/javascript">
  $(document).ready(function(){
    if("{{=request.vars['type']}}" != "None") var tipo = {{=request.vars['type']}}
      
    if (tipo == 2) $('#chkTipoCurso').removeProp('checked');
    else $('#chkTipoCurso').prop('checked')
    
    $('#chkTipoCurso').change(function() {
      if($(this).prop('checked')) document.location.href = "{{=URL('final_practice')}}"  //semestres
      else document.location.href = "{{=URL(vars=dict(year_period=0, type=2))}}" // periodos variables
    });

    //Colocar como activo el panel que contenga "period_year=nperiodo"
    $('#listaTab li').each(function(indice, elemento) {
      var link = $(this).find("a").prop("href");
      if (link.indexOf("year_period={{=currentyear_period.id}}") >= 0)
      $(this).addClass("active");
    });

    //como lleva el parametro tambien lo activa, con lo siguiente se desactiva
    $("#upload1").removeClass("active");
    $("#upload2").removeClass("active");
  });
</script>
{{end page_js/}}