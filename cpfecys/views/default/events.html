{{extend 'layout.html'}}
<div class="container" style="min-height: 100vh; display: flex; flex-direction: column;">
    <div class="row">
        <div class="title col-12">
            <h1>Eventos
                <small>{{=T(semester)}}, {{=year}}</small>
            </h1>
        </div>
        <form action="{{=URL('default','events')}}" method='get' class="form-inline mb-5">
            <div class="form-group">
                <select name="period" id="period-events" class="form-control">
                    {{for period in periods:}}
                        {{var_sel = ''}}
                        {{if period.id == actual_period:}}
                            {{var_sel = "selected='selected'"}}
                        {{pass}}
                        <option value="{{=period.id}}" {{=var_sel}}>
                            {{=T(period.period.name)}} - {{=period.yearp}}
                        </option>
                    {{pass}}
                </select>
            </div>
            <div class="form-group">
                <div class="custom-control custom-checkbox">
                    <input class="btn  btn-primary" type="submit" value="{{=T('Go')}}">
                    <input id="onchange-events" name="tipo_periodo" type="checkbox" checked data-toggle="toggle"
                        data-on="Semestres" data-off="Periodos" data-size="mini" class="custom-control-input">
                </div>
            </div>
            <div class="form-group ml-3">
                <a class="btn  btn-primary" onclick="$('.project').fadeIn();" role="button"><i class="fa fa-eye"></i>
                    {{=T('Show All')}}</a>
            </div>
        </form>

        <table class="table table-striped table-bordered table-responsive">
            <thead>
                <th>{{=T('Id')}}</th>
                <th>{{=T('Course')}}</th>
                <th>{{=T('Event Name')}}</th>
                <th>{{=T('Details')}}</th>
            </thead>
            <tbody>
                {{old_project_name = None}}
                {{counter = 1}}
                {{for r in thing:}}
                    <tr class="project project-{{=r.project.id}}">
                        <td>{{=counter}}</td>
                        {{if not old_project_name == r.project.name:}}
                            <td>
                                <a onclick="$('.project').not('.project-{{=r.project.id}}').fadeToggle();">{{=r.project.name}}</a>
                            </td>
                        {{else:}}
                            <td></td>
                        {{pass}}
                        {{old_project_name = r.project.name}}
                        <td>{{=r.public_event.name}}</td>
                        <td>
                            {{for s in r.public_event.public_event_schedule.select():}}
                                <b>{{=T('Location')}}:</b> {{=s.physical_location}} <br />
                                <b>{{=T('Start')}}:</b> {{=s.start_date}} <br />
                                <b>{{=T('End')}}:</b> {{=s.end_date}} <br />
                                <hr />
                            {{pass}}
                        </td>
                    </tr>
                    {{counter += 1}}
                {{pass}}
            </tbody>
        </table>
    </div>
</div>

<script>
    $(document).ready(function () {
		$("#onchange-events").change(function() {
            console.log('a')
			if($(this).prop('checked')) {
				$.ajax({
					url: "{{=URL('default', 'get_periods_on_change', vars=dict(period_type='1', period_id=actual_period))}}",
					type: 'GET',
					success: function(resp) {
						$("#period-events").empty();
						for (let element of resp){
							$("#period-events").append(element)
						}
					},
					cache: false,
					contentType: false,
					processData: false
            	});
			} else {
				$.ajax({
					url: "{{=URL('default', 'get_periods_on_change', vars=dict(period_type='2', period_id=actual_period))}}",
					type: 'GET',
					success: function(resp) {
						$("#period-events").empty();
						for (let element of resp){
							$("#period-events").append(element)
						}
					},
					cache: false,
					contentType: false,
					processData: false
            	});
			}
		})
	});
</script>