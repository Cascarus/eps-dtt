{{extend 'dashboard.html'}}
{{activity_permition = db((db.course_requirement.semester == year.id) & (db.course_requirement.project == project.id)
                        & (db.course_requirement.teacher_permition == True)).count()}}
<div class="navbar navbar-fixed-bottom mt-4">
    <div class="navbar-inner">
        <a class="brand" href="#"></a>
        <ul class="nav pull-left">
            {{if (request.vars['op'] == '2') and (((auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator')) or ((auth.has_membership('Teacher') or (request.vars['type'] == 'class' and auth.has_membership('Student') and (exception_s_var) and (tutor_access))))) and (course_ended)):}}
                <li>
                    <a style="color:white;text-shadow:none;background:#01A9DB;" class="btn-btn btn-primary" href="{{=URL('activity_control', 'course_first_recovery_test', vars=dict(project=request.vars['project'], year=request.vars['period']))}}">
                        <span class="icon-white icon-cog"></span>
                        {{=T('First Recovery Test')}}
                    </a>
                </li>
            {{pass}}

            {{if (request.vars['op']  == '3') and (((auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator')) or ((auth.has_membership('Teacher') or (request.vars['type'] == 'class' and auth.has_membership('Student') and (exception_s_var) and (tutor_access))))) and (course_ended)):}}
                <li>
                    <a style="color:white;text-shadow:none;background:#04B4AE;" class="btn-btn btn-primary" href="{{=URL('activity_control', 'course_second_recovery_test', vars=dict(project=request.vars['project'], year=request.vars['period']))}}">
                        <span class="icon-white icon-cog"></span>
                        {{=T('Second Recovery Test')}}
                    </a>
                </li>
            {{pass}}

            {{if cpfecys.current_year_period().id == year.id:}}
                {{if (request.vars['type'] == 'class') and (not course_ended) and (auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator') or auth.has_membership('Teacher') or (auth.has_membership('Student') and tutor_access and (exception_s_var or activity_permition > 0))):}}
                    <li>
                        <a style="color:white;text-shadow:none;" class="btn btn-primary" href="{{=URL('activity_control', 'course_requirement', vars=dict(project=request.vars['project'], period=request.vars['period']))}}">
                            <span class="fa fa-pencil"></span>
                            {{=T('Course requirement')}}
                        </a>
                    </li>
                {{elif (auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator')):}}
                    <li>
                        <a style="color:white;text-shadow:none;" class="btn btn-primary" href="{{=URL('activity_control', 'course_requirement', vars=dict(project=request.vars['project'], period=request.vars['period']))}}">
                            <span class="fa fa-pencil"></span>
                            {{=T('Course requirement')}}
                        </a>
                    </li>
                {{pass}}
            {{else:}}
                {{if (auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator')):}}
                    <li>
                        <a style="color:white;text-shadow:none;" class="btn btn-primary" href="{{=URL('activity_control', 'course_requirement', vars=dict(project=request.vars['project'], period=request.vars['period']))}}">
                            <span class="fa fa-pencil"></span>
                            {{=T('Course requirement')}}
                        </a>
                    </li>
                {{pass}}
            {{pass}}
            
            {{if (auth.has_membership('Super-Administrator') or auth.has_membership('Ecys-Administrator') or auth.has_membership('Teacher') or auth.has_membership('Student') or auth.has_membership('Academic')):}}
                <li>
                {{if (request.vars['op'] is None) or (request.vars['op'] == '1') or (request.vars['op'] == '0'):}}
                    <a style="color:white;text-shadow:none;" class="btn btn-success" href="{{=URL(vars=dict(project=project.id, period=year.id, list='True', type=request.vars['type'],op='1'))}}"><i class="icon-download icon-white"></i>
                {{elif request.vars['op'] == '2':}}
                    <a style="color:white;text-shadow:none;" class="btn btn-success" href="{{=URL(vars=dict(project=project.id, period=year.id, list='True', type=request.vars['type'],op='2'))}}"><i class="icon-download icon-white"></i>
                {{elif request.vars['op'] == '3':}}
                    <a style="color:white;text-shadow:none;" class="btn btn-success" href="{{=URL(vars=dict(project=project.id, period=year.id, list='True', type=request.vars['type'],op='3'))}}"><i class="icon-download icon-white"></i>
                {{pass}}
                        {{=T('Export Report')}} (CSV)
                    </a>
                </li>
            {{pass}}
                
            {{if (auth.has_membership('Super-Administrator') or auth.has_membership('Ecys-Administrator')) and course_ended:}}
                <li>
                    <a style="color:white;text-shadow:none;" class="btn btn-danger" href="{{=URL(vars=dict(project=project.id, period=year.id, list='cancel', type=request.vars['type']))}}"><i class="icon-ok icon-white"></i> 
                        {{=T('Enable Course')}}
                    </a>
                </li>    
            {{pass}}                
            
            {{if request.vars['type'] == 'class' and (auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator') or auth.has_membership('Teacher') or (auth.has_membership('Student') and exception_s_var and tutor_access)):}}
                <li>
                    <a style="color:white;text-shadow:none; cursor:pointer;" class="btn btn-warning" onclick="click_botton();"><i class="icon-warning-sign icon-white"></i> 
                        {{=T('Generate Document')}} {{=T('Format Technical School')}} (CSV)  
                        {{if not course_ended:}}
                            | <small>{{=T('Finish course')}}</small>
                        {{pass}}
                    </a>
                </li>
            {{pass}}
        </ul>
    </div>
</div>

<div class="row-fluid">
    <div class="well span12"  style="overflow:auto;">
        <a href="{{=URL('activity_control', 'students_control', vars=dict(project=project.id, period=year.id))}}" class="btn btn-primary" ><i class="icon-arrow-left"></i> {{=T('Back')}}</a>
        <table>
            <tr>
                <td colspan="4">
                    <b>
                        Reporte general de actividades
                        {{if request.vars['type'] == 'class':}}
                            - Curso
                        {{else:}}
                            - Laboratorio
                        {{pass}}
                    </b>
                </td>
            </tr>
            <tr>
                <td colspan="4">
                    <b>Datos generales del curso</b>
                </td>
            </tr>
            <tr>
                <td><b>Curso</b></td>
                <td>{{=project.name}}</td>
            
                <td><b>Semestre</b></td>
                <td>{{=T(year.period.name)}} {{=year.yearp}}</td>
            </tr>
            <tr>
                <td><b>Catedrático</b></td>
                {{if teacher is not None:}}
                    <td>{{=teacher.first_name}} {{=teacher.last_name}}</td>
                {{else:}}
                    <td>{{=T('Not Assigned')}}</td>
                {{pass}}
                <td><b>Tutor académico</b></td>
                {{for t1 in practice:}}
                    <td>{{=t1.first_name}} {{=t1.last_name}}</td>
                {{pass}}
            </tr>
            {{if auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator') or auth.has_membership('Teacher') or (auth.has_membership('Student') and tutor_access):}}
                <tr>
                    <td>
                        <b>{{=T('Laboratory')}}</b>
                    </td>
                    <td>
                        <a href="#RevalidationsModal" role="button" data-toggle="modal">{{=T('Revalidations:')}} {{=str(db((db.validate_laboratory.semester==year.id)&(db.validate_laboratory.project==project.id)&(db.validate_laboratory.validation_type==True)).count())}}</a>
                    </td>
                    <td>
                        <a href="#ReplacementModal" role="button" data-toggle="modal">{{=T('Equivalents:')}} {{=str(db((db.validate_laboratory.semester==year.id)&(db.validate_laboratory.project==project.id)&(db.validate_laboratory.validation_type==False)).count())}}</a>
                    </td>
                </tr>
            {{pass}}
        </table>
        {{if request.vars['type'] == 'class':}}
            <br>
            <ul class="nav nav-tabs">
                {{if (request.vars['op'] is None) or (request.vars['op']  == '1') or (request.vars['op']  == '0'):}}
                    <li class="nav-item active">
                {{else:}}
                    <li>
                {{pass}}  
                        <a class="nav-link" href="{{=URL(vars=dict(period=request.vars['period'], project=request.vars['project'], type=request.vars['type'], op='1'))}}">
                            {{=T(year.period.name)}} {{=str(year.yearp)}}
                        </a>
                    </li>
                
                {{if request.vars['op'] == '2':}}
                    <li class="nav-item active">
                {{else:}}
                    <li>
                {{pass}}  
                        {{if not course_ended:}}
                            <a class="nav-link" href="{{=URL(vars=dict(period=request.vars['period'], project=request.vars['project'], type=request.vars['type'], op='0'))}}">
                        {{else:}}          
                            <a class="nav-link" href="{{=URL(vars=dict(period=request.vars['period'], project=request.vars['project'], type=request.vars['type'], op='2'))}}">
                        {{pass}}
                                {{=T('First recovery test')}}
                            </a>
                    </li>

                {{if request.vars['op'] == '3':}}
                    <li class="nav-item active">
                {{else:}}
                    <li>
                {{pass}}                
                        {{if not course_ended:}}
                            <a class="nav-link" href="{{=URL(vars=dict(period=request.vars['period'], project=request.vars['project'], type=request.vars['type'], op='0'))}}">
                        {{else:}}          
                            <a class="nav-link" href="{{=URL(vars=dict(period=request.vars['period'], project=request.vars['project'], type=request.vars['type'], op='3'))}}">
                        {{pass}}
                                {{=T('Second recovery test')}}
                            </a>
                    </li>
            </ul>
        {{pass}}
        {{total_columns_table = 0}}
        <table class="table table-bordered">
            <thead>
                <tr>
                    <td bgcolor="#E6E6E6">
                        {{total_columns_table += 1}}
                        <b>
                            Carnet
                            <br>
                            &nbsp;
                        </b>
                    </td>
                    <td bgcolor="#E6E6E6">
                        {{total_columns_table += 1}}
                        <b>
                            Nombre
                            <br>
                            &nbsp;
                        </b>
                    </td>
                    {{pos_vcc = 0}}
                    {{if request.vars['type'] == 'class':}}
                        {{for category in course_category:}}
                            {{if category.category.category != "Laboratorio":}}
                                {{for c in course_activities[pos_vcc]:}}
                                    <td bgcolor="#E6E6E6" class="rcat{{=category.category}}" style="display:none;">
                                        {{total_columns_table += 1}}
                                        <center>
                                            <b>
                                                {{=c.name}}
                                                <br>
                                                &nbsp;
                                            </b>
                                        </center>
                                    </td>
                                {{pass}}
                                <td bgcolor="#E6E6E6">
                                    {{total_columns_table += 1}}
                                    <center>
                                        <b>
                                            <a id="btV_{{=str(category.category)}}" style="cursor:pointer;" onclick="visible_activities_gr('{{=str(category.category)}}');">
                                                {{=category.category.category}}
                                                <br>
                                                {{=category.grade}} pts
                                            </a>
                                            <a id="btnNV_{{=str(category.category)}}" style="cursor:pointer; display:none;" onclick="no_visible_activities_gr('{{=str(category.category)}}');">
                                                {{=category.category.category}}
                                                <br>
                                                {{=category.grade}} pts
                                            </a>
                                        </b>
                                    </center>
                                </td>
                                {{pos_vcc += 1}}
                            {{pass}}
                        {{pass}}
                    {{else:}}
                        {{for category in lab_category:}}
                            {{if category.category.category != "Laboratorio":}}
                                {{for c in lab_activities[pos_vcc]:}}
                                    <td bgcolor="#E6E6E6" class="rcat{{=str(category.category)}}" style="display:none;">
                                        {{total_columns_table += 1}}
                                        <center>
                                            <b>
                                                {{=c.name}}
                                                <br>
                                                &nbsp;
                                            </b>
                                        </center>
                                    </td>
                                {{pass}}
                                <td bgcolor="#E6E6E6">
                                    {{total_columns_table += 1}}
                                    <center>
                                        <b>
                                            <a id="btV_{{=str(category.category)}}" style="cursor:pointer;" onclick="visible_activities_gr('{{=str(category.category)}}');">
                                                {{=str(category.category.category)}}
                                                <br>
                                                {{=str(category.grade)}} pts
                                            </a>
                                            <a id="btnNV_{{=str(category.category)}}" style="cursor:pointer; display:none;" onclick="no_visible_activities_gr('{{=str(category.category)}}');">
                                                {{=str(category.category.category)}}
                                                <br>
                                                {{=str(category.grade)}} pts
                                            </a>
                                        </b>
                                    </center>
                                </td>
                                {{pos_vcc += 1}}
                            {{pass}}
                        {{pass}}
                    {{pass}}
                    
                    {{if request.vars['type'] == 'class' and exist_lab:}}
                        <td bgcolor="#E6E6E6">
                            {{total_columns_table += 1}}
                            <center>
                                <b>
                                    {{=T('Laboratory')}}
                                    <br>
                                    {{=str(totalLab)}} pts
                                </b>
                            </center>
                        </td>
                    {{pass}}
                    
                    {{if request.vars['type'] == 'class' and requirement is not None:}}
                        <td bgcolor="#E6E6E6">
                            {{total_columns_table += 1}}
                            <center>
                                <b>
                                    {{#T('Course Requeriment')}}
                                    {{=requirement.name}}
                                </b>
                            </center>
                        </td>
                    {{pass}}
                                {{if (request.vars['type'] == 'class' and request.vars['op']  == '2'):}}
                                    <td bgcolor="#E6E6E6" class="rcatfirst_r_t" style="display:none;">
                                        {{total_columns_table=total_columns_table+1}}
                                        <center>
                                            <b>
                                                    {{=T("First recovery test")}}
                                                    <br>
                                                    100.00 pts
                                            </b>
                                        </center>
                                    </td>
                                    <td bgcolor="#E6E6E6">
                                        {{total_columns_table=total_columns_table+1}}
                                        <center>
                                            <b>
                                                <a id="btV_first_r_t" style="cursor:pointer;" onclick="visible_activities_gr('first_r_t');">
                                                    {{=T("First recovery test")}}
                                                    <br>
                                                    {{=var_final_grade}} pts
                                                </a>
                                                <a id="btnNV_first_r_t" style="cursor:pointer; display:none;" onclick="no_visible_activities_gr('first_r_t');">
                                                    {{=T("First recovery test")}}
                                                    <br>
                                                    {{=var_final_grade}} pts
                                                </a>
                                            </b>
                                        </center>
                                    </td>
                                {{pass}}
                                {{if (request.vars['type'] == 'class' and request.vars['op']  == '3'):}}
                                    <td bgcolor="#E6E6E6" class="rcatsecond_r_t" style="display:none;">
                                        {{total_columns_table=total_columns_table+1}}
                                        <center>
                                            <b>
                                                    {{=T("Second recovery test")}}
                                                    <br>
                                                    100.00 pts
                                            </b>
                                        </center>
                                    </td>
                                    <td bgcolor="#E6E6E6">
                                        {{total_columns_table=total_columns_table+1}}
                                        <center>
                                            <b>
                                                <a id="btV_second_r_t" style="cursor:pointer;" onclick="visible_activities_gr('second_r_t');">
                                                    {{=T("Second recovery test")}}
                                                    <br>
                                                    {{=var_final_grade}} pts
                                                </a>
                                                <a id="btnNV_second_r_t" style="cursor:pointer; display:none;" onclick="no_visible_activities_gr('second_r_t');">
                                                    {{=T("Second recovery test")}}
                                                    <br>
                                                    {{=var_final_grade}} pts
                                                </a>
                                            </b>
                                        </center>
                                    </td>
                                {{pass}}
                                <td bgcolor="#2282A5">
                                    {{total_columns_table=total_columns_table+1}}
                                    <center>
                                        <b>
                                            <font Color="White">
                                                {{=T('Final Grade')}}
                                                <br>
                                                100 pts
                                            </font>
                                        </b>
                                    </center>
                                </td>
                                
                            </tr>
                        </thead>    
                        <TBODY>
                            {{for t1 in students:}}
                                {{if request.vars['type'] == 'class':}}
                                    <tr>
                                        <td>{{=t1.carnet.carnet}}</td>
                                        <td>
                                            {{try:}}
                                              {{var_auth_user = db((db.auth_user.id==t1.carnet.id_auth_user)).select().first()}}

                                              {{=var_auth_user.first_name}} {{=var_auth_user.last_name}} 
                                            {{except:}}
                                              {{None}}
                                            {{pass}}
                                        </td>


                                        <!--Position in the vector of activities-->
                                        {{pos_vcc=0}}
                                        <!--Vars to the control of grade of the student-->
                                        {{totalCategory=float(0)}}
                                        {{totalActivities=0}}
                                        {{totalCarry=float(0)}}
                                        <!--****************************************FILL THE GRADES OF THE STUDENT****************************************-->
                                        <!--COURSE ACTIVITIES-->
                                        {{for category in course_category:}}
                                            {{if category.category.category!="Laboratorio" and category.category.category!="Examen Final":}}
                                                {{totalCategory=float(0)}}
                                                {{totalActivities=0}}
                                                {{for c in course_activities[pos_vcc]:}}
                                                    <td class="rcat{{=str(category.category)}}" style="display:none;" bgcolor="#EEF6F9">
                                                        <center>
                                                            {{studentGrade = db((db.grades.activity==c.id)&(db.grades.academic_assignation==t1.id)).select().first()}}
                                                            {{if studentGrade is None:}}
                                                                {{totalCategory=totalCategory+float(0)}}
                                                            {{else:}}
                                                                {{if studentGrade.grade < float(controlP.min_average):}}
                                                                    <FONT COLOR="#FA4545">
                                                                {{elif studentGrade.grade>=float(controlP.min_average) and studentGrade.grade <= float(controlP.max_average):}}
                                                                    <FONT COLOR="#C5B911">
                                                                {{else:}}
                                                                    <FONT COLOR="Green">
                                                                {{pass}}
                                                                        {{=studentGrade.grade}}
                                                                </font>
                                                                {{if category.specific_grade==True:}}
                                                                    {{totalCategory=totalCategory+float((studentGrade.grade*c.grade)/100)}}
                                                                {{else:}}
                                                                    {{totalCategory=totalCategory+float(studentGrade.grade)}}
                                                                {{pass}}
                                                            {{pass}}
                                                        </center>
                                                    </td>
                                                    {{totalActivities=totalActivities+1}}
                                                {{pass}}
                                                <td>
                                                    <center>
                                                    {{if category.specific_grade==True:}}
                                                        {{checkGrade = float((totalCategory*float(100))/float(category.grade))}}
                                                        {{if checkGrade < float(controlP.min_average):}}
                                                            <FONT COLOR="#FA4545">
                                                        {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                            <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                        {{else:}}
                                                            <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                        {{pass}}
                                                        
                                                        {{=str(round(totalCategory,2))}}

                                                        </b>
                                                        </font>
                                                    {{else:}}
                                                        {{if totalActivities==0:}}
                                                            {{totalActivities=1}}
                                                        {{pass}}
                                                        {{totalActivities=totalActivities*100}}
                                                        {{totalCategory=float((totalCategory*float(category.grade))/float(totalActivities))}}
                                                        {{checkGrade = float((totalCategory*float(100))/float(category.grade))}}
                                                        {{if checkGrade < float(controlP.min_average):}}
                                                            <FONT COLOR="#FA4545">
                                                        {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                            <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                        {{else:}}
                                                            <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                        {{pass}}
                                                        
                                                        {{=str(round(totalCategory,2))}}
                                                        </b>
                                                        </font>
                                                    {{pass}}
                                                    {{totalCarry=totalCarry+totalCategory}}
                                                    </center>
                                                </td>
                                                {{pos_vcc=pos_vcc+1}}
                                            {{elif category.category.category=="Examen Final":}}
                                                {{totalCarry=int(round(totalCarry,0))}}
                                                {{totalCategory=float(0)}}
                                                {{totalActivities=0}}
                                                {{for c in course_activities[pos_vcc]:}}
                                                    <td class="rcat{{=str(category.category)}}" style="display:none;" bgcolor="#EEF6F9">
                                                        <center>
                                                            {{studentGrade = db((db.grades.activity==c.id)&(db.grades.academic_assignation==t1.id)).select().first()}}
                                                            {{if studentGrade is None:}}
                                                                {{totalCategory=totalCategory+float(0)}}
                                                            {{else:}}
                                                                {{if studentGrade.grade < float(controlP.min_average):}}
                                                                    <FONT COLOR="#FA4545">
                                                                {{elif studentGrade.grade>=float(controlP.min_average) and studentGrade.grade <= float(controlP.max_average):}}
                                                                    <FONT COLOR="#C5B911">
                                                                {{else:}}
                                                                    <FONT COLOR="Green">
                                                                {{pass}}
                                                                        {{=studentGrade.grade}}
                                                                </font>
                                                                {{if category.specific_grade==True:}}
                                                                    {{totalCategory=totalCategory+float((studentGrade.grade*c.grade)/100)}}
                                                                {{else:}}
                                                                    {{totalCategory=totalCategory+float(studentGrade.grade)}}
                                                                {{pass}}
                                                            {{pass}}
                                                        </center>
                                                    </td>
                                                    {{totalActivities=totalActivities+1}}
                                                {{pass}}
                                                <td>
                                                    <center>
                                                    {{if category.specific_grade==True:}}
                                                        {{checkGrade = float((totalCategory*float(100))/float(category.grade))}}
                                                        {{if checkGrade < float(controlP.min_average):}}
                                                            <FONT COLOR="#FA4545">
                                                        {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                            <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                        {{else:}}
                                                            <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                        {{pass}}
                                                        
                                                        {{=str(round(totalCategory,2))}}

                                                        </b>
                                                        </font>
                                                    {{else:}}
                                                        {{if totalActivities==0:}}
                                                            {{totalActivities=1}}
                                                        {{pass}}
                                                        {{totalActivities=totalActivities*100}}
                                                        {{totalCategory=float((totalCategory*float(category.grade))/float(totalActivities))}}
                                                        {{checkGrade = float((totalCategory*float(100))/float(category.grade))}}
                                                        {{if checkGrade < float(controlP.min_average):}}
                                                            <FONT COLOR="#FA4545">
                                                        {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                            <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                        {{else:}}
                                                            <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                        {{pass}}
                                                        
                                                        {{=str(round(totalCategory,2))}}
                                                        </b>
                                                        </font>
                                                    {{pass}}
                                                    {{totalCategory=int(round(totalCategory,0))}}
                                                    {{totalCarry=totalCarry+totalCategory}}
                                                    </center>
                                                </td>
                                                {{pos_vcc=pos_vcc+1}}
                                            {{pass}}

                                        {{pass}}
                                        {{if request.vars['type'] == 'class' and exist_lab==True:}}
                                            <td>
                                                <center>
                                                    {{totalCategory=float(0)}}
                                                    {{isValidate=False}}
                                                    <!--Revalidation of laboratory-->
                                                    {{for validate in validateLaboratory:}}
                                                        {{if validate.carnet==t1.carnet:}}
                                                            {{isValidate=True}}
                                                            {{totalCategory=float((int(round(validate.grade,0))*totalLab)/100)}}
                                                        {{pass}}
                                                    {{pass}}


                                                    <!--Doesnt has a revalidation-->
                                                    {{if isValidate==False:}}
                                                        <!--Position in the vector of activities-->
                                                        {{posVCC_Lab=0}}
                                                        <!--Vars to the control of grade of the student-->
                                                        {{totalCategory_Lab=float(0)}}
                                                        {{totalActivities_Lab=0}}
                                                        {{totalCarry_Lab=float(0)}}

                                                        <!--****************************************FILL THE GRADES OF THE STUDENT****************************************-->
                                                        <!--LAB ACTIVITIES-->
                                                        {{for category_Lab in lab_category:}}
                                                            {{totalCategory_Lab=float(0)}}
                                                            {{totalActivities_Lab=0}}
                                                            {{for c_Lab in lab_activities[posVCC_Lab]:}}
                                                                        {{studentGrade = db((db.grades.activity==c_Lab.id)&(db.grades.academic_assignation==t1.id)).select().first()}}
                                                                        {{if studentGrade is None:}}
                                                                            {{totalCategory_Lab=totalCategory_Lab+float(0)}}
                                                                        {{else:}}
                                                                            {{if category_Lab.specific_grade==True:}}
                                                                                {{totalCategory_Lab=totalCategory_Lab+float((studentGrade.grade*c_Lab.grade)/100)}}
                                                                            {{else:}}
                                                                                {{totalCategory_Lab=totalCategory_Lab+float(studentGrade.grade)}}
                                                                            {{pass}}
                                                                        {{pass}}
                                                                {{totalActivities_Lab=totalActivities_Lab+1}}
                                                            {{pass}}
                                                            

                                                                {{if category_Lab.specific_grade==False:}}
                                                                    {{if totalActivities_Lab==0:}}
                                                                        {{totalActivities_Lab=1}}
                                                                    {{pass}}
                                                                    {{totalActivities_Lab=totalActivities_Lab*100}}
                                                                    {{totalCategory_Lab=float((totalCategory_Lab*float(category_Lab.grade))/float(totalActivities_Lab))}}
                                                                {{pass}}
                                                                {{totalCarry_Lab=totalCarry_Lab+totalCategory_Lab}}
                                                            {{posVCC_Lab=posVCC_Lab+1}}
                                                        {{pass}}
                                                        {{totalCategory=float((int(round(totalCarry_Lab,0))*totalLab)/100)}}
                                                    {{pass}}


                                                    <!--Show grade of laboratory-->
                                                    {{checkGrade = float((totalCategory*float(100))/float(totalLab))}}
                                                    {{if checkGrade < float(controlP.min_average):}}
                                                        <FONT COLOR="#FA4545">
                                                    {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                        <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                    {{else:}}
                                                        <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                    {{pass}}
                                                    
                                                    {{=str(round(totalCategory,2))}}

                                                    </b>
                                                    </font>
                                                    <!--Plus the laboratory to the carry-->
                                                    {{totalCarry=totalCarry+totalCategory}}
                                                </center>
                                            </td>
                                        {{pass}}
                                        {{if request.vars['type'] == 'class' and requirement is not None:}}
                                            <td width="10px" bgcolor="#F2F5A9">
                                                <center>
                                                    <b>
                                                        {{if db((db.course_requirement_student.carnet==t1.carnet)&(db.course_requirement_student.requirement==requirement.id)).select().first() is not None:}}
                                                            <i class="icon-ok"></i>
                                                        {{pass}}
                                                    </b>
                                                </center>
                                            </td>
                                        {{pass}}

                                        {{if request.vars['type'] == 'class' and request.vars['op'] == '2':}}
                                            <td class="rcatfirst_r_t" width="100px" style="display:none;" bgcolor="#EEF6F9">
                                                <center>
                                                    {{var_first_recovery_test = db((db.course_first_recovery_test.carnet == t1.carnet) & (db.course_first_recovery_test.semester == int(request.vars['period']))
                                                                                & (db.course_first_recovery_test.project == int(request.vars['project']))).select().first()}}
                                                    {{if var_first_recovery_test is not None:}}
                                                        {{if var_first_recovery_test.grade < float(controlP.min_average):}}
                                                            <FONT COLOR="#FA4545">
                                                        {{elif var_first_recovery_test.grade>=float(controlP.min_average) and var_first_recovery_test.grade <= float(controlP.max_average):}}
                                                            <FONT STYLE="color: #C5B911;">
                                                        {{else:}}
                                                            <FONT STYLE="color: Green; ">
                                                        {{pass}}
                                                            {{=round( (var_first_recovery_test.grade),2)}}                                                                
                                                        </font>
                                                    {{pass}}
                                                </center>
                                            </td>
                                            <td width="100px" >
                                                <center>
                                                    
                                                        {{var_first_recovery_test =db((db.course_first_recovery_test.carnet==t1.carnet)&(db.course_first_recovery_test.semester==int(request.vars['period']))&(db.course_first_recovery_test.project==int(request.vars['project']))).select().first()}}
                                                        {{if var_first_recovery_test is not None:}}
                                                            {{if var_first_recovery_test.grade < float(controlP.min_average):}}
                                                                <FONT COLOR="#FA4545">
                                                            {{elif var_first_recovery_test.grade>=float(controlP.min_average) and var_first_recovery_test.grade <= float(controlP.max_average):}}
                                                                <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                            {{else:}}
                                                                <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                            {{pass}}

                                                                {{=round( (var_first_recovery_test.grade)*var_final_grade/100,2)}}
                                                                {{totalCarry=totalCarry+round( (var_first_recovery_test.grade)*var_final_grade/100,0)}}
                                                            </font>
                                                        {{pass}}
                                                    
                                                </center>
                                            </td>
                                        {{pass}}

                                        {{if request.vars['type'] == 'class' and request.vars['op'] =='3':}}
                                            <td class="rcatsecond_r_t" width="100px" style="display:none;" bgcolor="#EEF6F9">
                                                <center>
                                                    
                                                        {{var_second_recovery_test =db((db.course_second_recovery_test.carnet==t1.carnet)&(db.course_second_recovery_test.semester==int(request.vars['period']))&(db.course_second_recovery_test.project==int(request.vars['project']))).select().first()}}
                                                        {{if var_second_recovery_test is not None:}}
                                                            {{if var_second_recovery_test.grade < float(controlP.min_average):}}
                                                                <FONT COLOR="#FA4545">
                                                            {{elif var_second_recovery_test.grade>=float(controlP.min_average) and var_second_recovery_test.grade <= float(controlP.max_average):}}
                                                                <FONT STYLE="color: #C5B911;">
                                                            {{else:}}
                                                                <FONT STYLE="color: Green; ">
                                                            {{pass}}
                                                                {{=round( (var_second_recovery_test.grade),2)}}                                                                
                                                            </font>
                                                        {{pass}}
                                                    
                                                </center>
                                            </td>
                                            <td width="100px" >
                                                <center>
                                                    
                                                        {{var_second_recovery_test =db((db.course_second_recovery_test.carnet==t1.carnet)&(db.course_second_recovery_test.semester==int(request.vars['period']))&(db.course_second_recovery_test.project==int(request.vars['project']))).select().first()}}
                                                        {{if var_second_recovery_test is not None:}}
                                                            {{if var_second_recovery_test.grade < float(controlP.min_average):}}
                                                                <FONT COLOR="#FA4545">
                                                            {{elif var_second_recovery_test.grade>=float(controlP.min_average) and var_second_recovery_test.grade <= float(controlP.max_average):}}
                                                                <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                            {{else:}}
                                                                <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                            {{pass}}

                                                                {{=round( (var_second_recovery_test.grade)*var_final_grade/100,2)}}
                                                                {{totalCarry=totalCarry+round( (var_second_recovery_test.grade)*var_final_grade/100,0)}}
                                                            </font>
                                                        {{pass}}
                                                    
                                                </center>
                                            </td>
                                        {{pass}}

                                        <td>
                                            <center>
                                                {{if request.vars['type'] == 'class' and exist_lab==True:}}
                                                    {{if request.vars['type'] == 'class' and requirement is None:}}
                                                        {{if totalCategory>=float((61*totalLab)/100):}}
                                                            {{if round(totalCarry,0) < float(controlP.min_average):}}
                                                                <span class="badge badge-danger">
                                                            {{elif round(totalCarry,0)>=float(controlP.min_average) and round(totalCarry,0) <= float(controlP.max_average):}}
                                                                <span class="badge badge-warning">
                                                            {{else:}}
                                                                <span class="badge badge-success">
                                                            {{pass}}
                                                            {{=str(int(round(totalCarry,0)))}}
                                                            </span>
                                                        {{else:}}
                                                            <span class="badge badge-secondary">
                                                                {{=str(int(round(totalCarry,0)))}}
                                                            </span>
                                                        {{pass}}
                                                    {{else:}}
                                                        {{if db((db.course_requirement_student.carnet==t1.carnet)&(db.course_requirement_student.requirement==requirement.id)).select().first() is not None:}}
                                                            {{if totalCategory>=float((61*totalLab)/100):}}
                                                                {{if round(totalCarry,0) < float(controlP.min_average):}}
                                                                    <span class="badge badge-danger">
                                                                {{elif round(totalCarry,0)>=float(controlP.min_average) and round(totalCarry,0) <= float(controlP.max_average):}}
                                                                    <span class="badge badge-warning">
                                                                {{else:}}
                                                                    <span class="badge badge-success">
                                                                {{pass}}
                                                                {{=str(int(round(totalCarry,0)))}}
                                                                </span>
                                                            {{else:}}
                                                                <span class="badge badge-secondary">
                                                                    {{=str(int(round(totalCarry,0)))}}
                                                                </span>
                                                            {{pass}}
                                                        {{else:}}
                                                            <span class="label label-inverse">
                                                                {{=str(int(round(totalCarry,0)))}}
                                                            </span>
                                                        {{pass}}
                                                    {{pass}}
                                                {{else:}}
                                                    {{if request.vars['type'] == 'class' and requirement is None:}}
                                                        {{if round(totalCarry,0) < float(controlP.min_average):}}
                                                            <span class="badge badge-danger">
                                                        {{elif round(totalCarry,0)>=float(controlP.min_average) and round(totalCarry,0) <= float(controlP.max_average):}}
                                                            <span class="badge badge-warning">
                                                        {{else:}}
                                                            <span class="badge badge-success">
                                                        {{pass}}
                                                        {{=str(int(round(totalCarry,0)))}}
                                                        </span>
                                                    {{else:}}
                                                        {{if db((db.course_requirement_student.carnet==t1.carnet)&(db.course_requirement_student.requirement==requirement.id)).select().first() is not None:}}
                                                            {{if round(totalCarry,0) < float(controlP.min_average):}}
                                                                <span class="badge badge-danger">
                                                            {{elif round(totalCarry,0)>=float(controlP.min_average) and round(totalCarry,0) <= float(controlP.max_average):}}
                                                                <span class="badge badge-warning"">
                                                            {{else:}}
                                                                <span class="badge badge-success">
                                                            {{pass}}
                                                            {{=str(int(round(totalCarry,0)))}}
                                                            </span>
                                                        {{else:}}
                                                            <span class="label label-inverse">
                                                                {{=str(int(round(totalCarry,0)))}}
                                                            </span>
                                                        {{pass}}
                                                    {{pass}}
                                                {{pass}}
                                            </center>
                                        </td>
                                    </tr>
                                    {{pos_vcc=0}}
                                    {{totalCategory=float(0)}}
                                    {{totalActivities=0}}
                                    {{totalCarry=float(0)}}
                                {{else:}}
                                    <tr>
                                        <td>{{=t1.carnet.carnet}}</td>
                                        <td>
                                            {{try:}}
                                              {{var_auth_user = db((db.auth_user.id==t1.carnet.id_auth_user)).select().first()}}

                                              {{=var_auth_user.first_name}} {{=var_auth_user.last_name}} 
                                            {{except:}}
                                              {{None}}
                                            {{pass}}
                                        </td>
                                        <!--Position in the vector of activities-->
                                        {{pos_vcc=0}}
                                        <!--Vars to the control of grade of the student-->
                                        {{totalCategory=float(0)}}
                                        {{totalActivities=0}}
                                        {{totalCarry=float(0)}}
                                        <!--****************************************FILL THE GRADES OF THE STUDENT****************************************-->
                                        <!--COURSE ACTIVITIES-->
                                        {{for category in lab_category:}}
                                            {{totalCategory=float(0)}}
                                            {{totalActivities=0}}
                                            {{for c in lab_activities[pos_vcc]:}}
                                                <td class="rcat{{=str(category.category)}}" style="display:none;"  bgcolor="#EEF6F9">
                                                    <center>
                                                        {{studentGrade = db((db.grades.activity==c.id)&(db.grades.academic_assignation==t1.id)).select().first()}}
                                                        {{if studentGrade is None:}}
                                                            {{totalCategory=totalCategory+float(0)}}
                                                        {{else:}}
                                                            {{if studentGrade.grade < float(controlP.min_average):}}
                                                                <FONT COLOR="#FA4545">
                                                            {{elif studentGrade.grade>=float(controlP.min_average) and studentGrade.grade <= float(controlP.max_average):}}
                                                                <FONT COLOR="#C5B911">
                                                            {{else:}}
                                                                <FONT COLOR="Green">
                                                            {{pass}}
                                                                    {{=studentGrade.grade}}
                                                            </font>
                                                            {{if category.specific_grade==True:}}
                                                                
                                                                {{totalCategory=totalCategory+float((studentGrade.grade*c.grade)/100)}}
                                                            {{else:}}
                                                                
                                                                {{totalCategory=totalCategory+float(studentGrade.grade)}}
                                                            {{pass}}
                                                        {{pass}}
                                                    </center>
                                                </td>
                                                {{totalActivities=totalActivities+1}}
                                            {{pass}}
                                            <td>
                                                <center>
                                                {{if category.specific_grade==True:}}
                                                    {{checkGrade = float((totalCategory*float(100))/float(category.grade))}}
                                                    {{if checkGrade < float(controlP.min_average):}}
                                                        <FONT COLOR="#FA4545">
                                                    {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                        <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                    {{else:}}
                                                        <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                    {{pass}}
                                                   
                                                    {{=str(round(totalCategory,2))}}

                                                    </b>
                                                    </font>
                                                {{else:}}
                                                    {{if totalActivities==0:}}
                                                        {{totalActivities=1}}
                                                    {{pass}}
                                                    {{totalActivities=totalActivities*100}}
                                                    {{totalCategory=float((totalCategory*float(category.grade))/float(totalActivities))}}
                                                    {{checkGrade = float((totalCategory*float(100))/float(category.grade))}}
                                                    {{if checkGrade < float(controlP.min_average):}}
                                                        <FONT COLOR="#FA4545">
                                                    {{elif checkGrade>=float(controlP.min_average) and checkGrade <= float(controlP.max_average):}}
                                                        <FONT STYLE="color: #C5B911; text-shadow: -1px -1px 0 #F2F5A9, 1px -1px 0 #F2F5A9, -1px 1px 0 #F2F5A9, 1px 1px 0 #F2F5A9;   ">
                                                    {{else:}}
                                                        <FONT STYLE="color: Green; text-shadow: -1px -1px 0 #CBE9C4, 1px -1px 0 #CBE9C4, -1px 1px 0 #CBE9C4, 1px 1px 0 #CBE9C4;   ">
                                                    {{pass}}
                                                    
                                                    {{=str(round(totalCategory,2))}}

                                                    </b>
                                                    </font>
                                                {{pass}}
                                                {{totalCarry=totalCarry+totalCategory}}
                                                </center>
                                            </td>
                                            {{pos_vcc=pos_vcc+1}}
                                        {{pass}}
                                        <td>
                                            <center>
                                                {{if round(totalCarry,0) < float(controlP.min_average):}}
                                                    <span class="badge badge-danger">
                                                {{elif round(totalCarry,0)>=float(controlP.min_average) and round(totalCarry,0) <= float(controlP.max_average):}}
                                                    <span class="badge badge-warning">
                                                {{else:}}
                                                    <span class="badge badge-success">
                                                {{pass}}
                                                {{=str(int(round(totalCarry,0)))}}
                                                </span>
                                            </center>
                                        </td>
                                    </tr>
                                    {{pos_vcc=0}}
                                    {{totalCategory=float(0)}}
                                    {{totalActivities=0}}
                                    {{totalCarry=float(0)}}
                                {{pass}}
                            {{pass}}
                        </TBODY>
                        <TFOOT>
                            <tr>
                                <td colspan="{{=total_columns_table}}">
                                    <center>
                                        <table class="table table-striped table-bordered">
                                            <tr>
                                                <td>
                                                    <span class="label label-success">&nbsp;&nbsp;&nbsp;</span>&nbsp;<b>{{=T('Notes above average')}} </b>
                                                </td>
                                                
                                                <td>
                                                    <span class="label label-warning">&nbsp;&nbsp;&nbsp;</span>&nbsp;<b>{{=T('Notes on the average')}} </b>
                                                </td>
                                                
                                                <td>
                                                    <span class="label label-important">&nbsp;&nbsp;&nbsp;</span>&nbsp;<b>{{=T('Notes Below Average')}}</b>
                                                </td>

                                                {{if request.vars['type'] == 'class':}}
                                                <td>
                                                    <span class="label label-inverse">&nbsp;&nbsp;&nbsp;</span>&nbsp;<b>{{=T('Laboratory lost or Missing requirement')}}</b>
                                                    <br>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="icon-flag"></i><font color="#FA4545">{{=T('Only applies to final mark')}}</font>
                                                </td>
                                                {{pass}}
                                            </tr>
                                        </table>
                                    </center>
                                </td>
                            </tr>
                        </TFOOT>
                    </table>
    </div>
</div>

<script type="text/javascript">
    function no_visible_activities_gr(var_name){
        {{if request.vars['type'] == 'class':}}
            {{for category in course_category:}}
                {{if category.category.category!="Laboratorio":}}
                    if (var_name=="{{=str(category.category)}}"){
                        $("#btnNV_{{=str(category.category)}}").css("display", "none");
                        $("#btV_{{=str(category.category)}}").css("display", "");
                        $(".rcat{{=str(category.category)}}").css("display", "none");
                    }
                {{pass}}
            {{pass}}
            if (var_name=="first_r_t"){
                    $("#btnNV_first_r_t").css("display", "none");
                    $("#btV_first_r_t").css("display", "");
                    $(".rcatfirst_r_t").css("display", "none");

                }else{
                    if (var_name=="second_r_t"){
                        $("#btnNV_second_r_t").css("display", "none");
                        $("#btV_second_r_t").css("display", "");
                        $(".rcatsecond_r_t").css("display", "none");
                    }
                }    
        {{else:}}
            {{for category in lab_category:}}
                if (var_name=="{{=str(category.category)}}"){
                    $("#btnNV_{{=str(category.category)}}").css("display", "none");
                    $("#btV_{{=str(category.category)}}").css("display", "");
                    $(".rcat{{=str(category.category)}}").css("display", "none");
                }
            {{pass}}
        {{pass}}>
    }

    function visible_activities_gr(var_name){
        {{if request.vars['type'] == 'class':}}
            {{for category in course_category:}}
                {{if category.category.category!="Laboratorio":}}
                    if (var_name=="{{=str(category.category)}}"){
                        $("#btnNV_{{=str(category.category)}}").css("display", "");
                        $("#btV_{{=str(category.category)}}").css("display", "none");
                        $(".rcat{{=str(category.category)}}").css("display", "");
                    }
                {{pass}}
                

            {{pass}}  
            if (var_name=="first_r_t"){
                    $("#btnNV_first_r_t").css("display", "");
                    $("#btV_first_r_t").css("display", "none");
                    $(".rcatfirst_r_t").css("display", "");
                }else{
                    if (var_name=="second_r_t"){
                        $("#btnNV_second_r_t").css("display", "");
                        $("#btV_second_r_t").css("display", "none");
                        $(".rcatsecond_r_t").css("display", "");
                    }
                }  
        {{else:}}
            {{for category in lab_category:}}
                if (var_name=="{{=str(category.category)}}"){
                    $("#btnNV_{{=str(category.category)}}").css("display", "");
                    $("#btV_{{=str(category.category)}}").css("display", "none");
                    $(".rcat{{=str(category.category)}}").css("display", "");
                }
            {{pass}}
        {{pass}}
    }

    function click_botton(){
        {{if course_ended == False:}}
            var r = confirm("{{=T('After generating the file will no longer be allowed to make changes within the course and the lab. Are you sure you want to continue?')}}");
            if (r == true) {
                {{if (request.vars['op'] == None) or (request.vars['op']  == '1') or (request.vars['op']  == '0'):}}
                    window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='1'))}}";
                {{elif request.vars['op']  == '2':}}
                    window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='2'))}}";
                {{elif request.vars['op']  == '3':}}
                    window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='3'))}}";
                {{pass}}
            }
        {{else:}}
            {{if (request.vars['op'] == None) or (request.vars['op']  == '1') or (request.vars['op']  == '0'):}}
                window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='1'))}}";
            {{elif request.vars['op']  == '2':}}
                window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='2'))}}";
            {{elif request.vars['op']  == '3':}}
                window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='3'))}}";
            {{pass}}
        {{pass}}
    }

    $(document).ready(function(){
    {{if action_Export==True:}}
        {{if (request.vars['op'] == None) or (request.vars['op']  == '1') or (request.vars['op']  == '0'):}}
            window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='1'))}}";
        {{elif request.vars['op']  == '2':}}
            window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='2'))}}";
        {{elif request.vars['op']  == '3':}}
            window.location.href = "{{=URL('activity_control','general_report_activities',vars=dict(project = project.id, period = year.id, list='False', type=request.vars['type'],op='3'))}}";
        {{pass}}
    {{pass}}
});

</script>


{{if auth.has_membership('Ecys-Administrator') or auth.has_membership('Super-Administrator') or auth.has_membership('Teacher') or (auth.has_membership('Student') and tutor_access == True):}}
    <!--Validate Laboratory-->
    <div id="RevalidationsModal" class="modal hide fade" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h3 id="myModalLabel">
              {{=T('Validate Laboratory')}}
          </h3>
      </div>
      <div class="modal-body">
        <div class="well">
            <div align="right">
                <a  class = "btn btn-success" title="{{=T('Go to Laboratory Revalidation')}}" href="{{=URL('activity_control', 'validate_laboratory',vars=dict(project = project.id, year = year.id))}}" >
                    <span class="fa fa-check-circle"></span>  {{=T('Validate Laboratory')}}
                </a>
            </div>
            <table class="table table-bordered ">
                <thead>
                    <tr>
                        <th>
                            Carnet
                        </th>
                        <th>
                            Nota
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {{for revalidation in db((db.academic.id==db.validate_laboratory.carnet)&(db.validate_laboratory.semester==year.id)&(db.validate_laboratory.project==project.id)&(db.validate_laboratory.validation_type==True)).select(orderby=db.academic.carnet):}}
                    <tr>
                        <td>
                            {{=str(revalidation.validate_laboratory.carnet.carnet)}}
                        </td>
                        <td>
                            {{=str(revalidation.validate_laboratory.grade)}}
                        </td>
                    </tr>
                    {{pass}}
                </tbody>
            </table>
        </div>
      </div>
      <div class="modal-footer">
          <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
      </div>
    </div>
    <!--Validate Laboratory-->


    <!--Laboratory replacing-->
    <div id="ReplacementModal" class="modal hide fade" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h3 id="myModalLabel">
              {{=T('Laboratory Equivalence')}}
          </h3>
      </div>
      <div class="modal-body">
        <div class="well">
            <div align="right">
                <a  class = "btn btn-success" title="{{=T('Go to Laboratory Equivalence')}}" href="{{=URL('activity_control', 'laboratory_replacing',vars=dict(project = project.id, year = year.id))}}" >
                    <span class="icon-white icon-certificate"></span>  {{=T('Laboratory Equivalence')}}
                </a>
            </div>
            <table class="table table-bordered ">
                <thead>
                    <tr>
                        <th>
                            Carnet
                        </th>
                        <th>
                            Nota
                        </th>
                    </tr>
                </thead>
                <tbody>
                    {{for revalidation in db((db.academic.id==db.validate_laboratory.carnet)&(db.validate_laboratory.semester==year.id)&(db.validate_laboratory.project==project.id)&(db.validate_laboratory.validation_type==False)).select(orderby=db.academic.carnet):}}
                    <tr>
                        <td>
                            {{=str(revalidation.validate_laboratory.carnet.carnet)}}
                        </td>
                        <td>
                            {{=str(revalidation.validate_laboratory.grade)}}
                        </td>
                    </tr>
                    {{pass}}
                </tbody>
            </table>
        </div>
      </div>
      <div class="modal-footer">
          <button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">{{=T('Close')}}</button>
      </div>
    </div>
    <!--Laboratory replacing-->
{{pass}}